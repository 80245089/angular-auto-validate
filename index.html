<!DOCTYPE html>
<html ng-app="jcs-demo">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="http://prismjs.com/themes/prism.css" />
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,200' rel='stylesheet' type='text/css'>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Angular-auto-validate by jonsamwell</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Angular-auto-validate</h1>
        <h2>An automatic validation module for AngularJS which gets rid of excess html in favour of dynamic element modification to notify the user of validation errors</h2>
        <a href="https://github.com/jonsamwell/angular-auto-validate" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
            <h3 id="demo">Demo.</h3>
            <p>The below demo shows the functionality of this module.  Start typing into the inout boxes to see the validation.</p>

            <div ng-controller="demoCtrl">
            <p>
                <button type="button" class="btn btn-primary" ng-click="toggleBS3Icons();">Toggle Validation State Icons</button>
            </p>
            <form role="form" novalidate="novalidate">
                <div class="form-group">
                    <label class="control-label">Name</label>
                    <input type="email"
                           class="form-control"
                           placeholder="Enter Name"
                           ng-model="user.name"
                           required="required" />
                </div>
                <div class="form-group">
                    <label class="control-label">Email address - <small>Element with a custom element modifier (see source code)</small></label>
                    <input type="email"
                           class="form-control"
                           placeholder="Enter email"
                           ng-model="user.email"
                           required="required"
                           element-modifier="myCustomModifierKey">
                </div>
                <div class="form-group">
                    <label class="control-label">Password - <small>Element with validation happening on blur rather than change</small></label>
                    <input type="password" class="form-control"
                           ng-model="user.password"
                           placeholder="Password"
                           required="required"
                           ng-minlength="6"
                           ng-model-options="{updateOn: 'blur'}">
                </div>
                <div class="form-group">
                    <label class="control-label">Robot Test: Please spell Angular. - <small>Custom validation</small></label>
                    <input type="text"
                           class="form-control"
                           placeholder="Enter The Word Angular"
                           ng-model="user.iq"
                           mustcontainword="angular"/>
                </div>

                <button type="submit" class="btn btn-default">Submit</button>
            </form>
        </div>

          <h3 id="getting_started">Getting Started.</h3>
            <div class="callout">
                <p>For the best overview of the module and module architecture see my <a href="http://www.jonsamwell.com/angular-auto-validate">original blog post here</a>.</p>
            </div>

            <p>Install and manage AngularStrap with <a href="http://bower.io">Bower</a>.</p>
            <pre><code class="language-javascript">$ bower install angular-auto-validate --save</code></pre>

            <p>Load the required javascript libraries</p>
            <pre><code class="language-markup">&lt;script src="bower_components/angular-auto-validate/dist/angular-auto-validate.min.js"&gt;&lt;/script&gt;</code></pre>

            <p>Inject the jcs-auto-validate into your application</p>
            <pre><code class="language-javascript">angular.module('my-app', ['jcs-auto-validate']);</code></pre>

            <p>If you are using bootstrap 3 that's it, unless you wish the valid and invalid states of your controls to be
                indicated via icons, otherwise auto-valiadte is setup!
            <pre><code class="language-javascript">angular.module('my-app')
        .run([
        'bootstrap3ElementModifier',
        function (bootstrap3ElementModifier) {
              bootstrap3ElementModifier.enableValidationStateIcons(true);
       }]);</code></pre>

            <p>if you are using Foundation 5 you will need to set the Foundation 5 element modifier as the default one</p>
            <pre><code class="language-javascript">angular.module('my-app')
       .run([
       'validator',
       'foundation5ElementModifier',
       function (validator, foundation5ElementModifier) {
           validator.setDefaultElementModifier(foundation5ElementModifier.key);
       }]);</code></pre>

            <p>If you are not using Bootstrap3 or Foundation5 you will need to create a custom element modifier so <a href="custom_dom_modifiers">see the below section</a></p>

            <h3 id="your_form">Your Form</h3>
            <p>Now that you are using auto-validate you haven't got to worry about putting your error messages in you html
            or using any angular expressions to show or hide them depending on the validation state.  So now your form markup remains
            clean and maintainable</p>
<pre><code class="language-markup">&lt;form name=&quot;signupFrm&quot; novalidate=&quot;novalidate&quot;&gt;
    &lt;div classs=&quot;form-row&quot;&gt;
        &lt;label&gt;Username:&lt;/label&gt;
        &lt;input name=&quot;username&quot;
            ng-model=&quot;model.username&quot;
            ng-minlength=&quot;3&quot;
            ng-maxlength=&quot;10&quot;
            required/&gt;
    &lt;/div&gt;
    &lt;div classs=&quot;form-row&quot;&gt;
        &lt;label&gt;Password:&lt;/label&gt;
        &lt;input name=&quot;password&quot;
            type=&quot;password&quot;
            ng-model=&quot;model.username&quot;
            ng-minlength=&quot;3&quot;
            ng-maxlength=&quot;10&quot;
            required/&gt;
    &lt;/div&gt;
&lt;/form&gt;
</code></pre>

            <h4>Changing Element States</h4>
            <p>If you want a certain element to appear differently to other elemenets when it is valid/invalid you can still do that by just specifying which element modifier
                should be used to modifier the elements visual state. This can be achieve by using the attribute <code>element-modifier="elementModifierKey"</code>.</p>
<pre><code class="language-markup">&lt;!-- auto-validate will use the default element modifier --&gt;
&lt;input type=&quot;text&quot;
    ng-model=&quot;model.firstname&quot;
    required
    ng-minlength=&quot;2&quot; /&gt;

&lt;!-- auto-validate will try to find a custom modifier with the key 'myCustomModifier' --&gt;
&lt;input type=&quot;text&quot;
    ng-model=&quot;model.middlename&quot;
    required
    ng-minlength=&quot;2&quot;
    element-modifier=&quot;myCustomModifier&quot; /&gt;

&lt;!-- auto-validate will try to find a custom modifier with the key 'myOtherCustomModifier' --&gt;
&lt;input type=&quot;text&quot;
    ng-model=&quot;model.surname&quot;
    required
    ng-minlength=&quot;2&quot;
    element-modifier=&quot;myOtherCustomModifier&quot; /&gt;
</code></pre>

            <h3 id="error_message_resolver">Error Message Resolver</h3>
            <p>An error message resolver is an object that turns a validation error type (required, minlength etc) into an actual validation message
                that can be displayed to the user to help them rectify the validation error.  By default auto-validate has one built in that contains
            English error messages for all the default angular validation types.  However if you have custom validation filters you will need to add them
            to the default error message resolver in order to provide a custom error message when that validation type if triggered.</p>

            <pre><code class="language-javascript">angular.module('jcs-autoValidate')
    .run([
    'defaultErrorMessageResolver',
    function (validator, defaultErrorMessageResolver) {
        defaultErrorMessageResolver.errorMessages['myCustomError'] = 'My custom error message';
        defaultErrorMessageResolver.errorMessages['anotherErrorMessage'] = 'An error message with the attribute value in {0}';
    }
]);
            </code></pre>

            <h4 id="custom_error_resolver">Custom Error Message Resolver</h4>
            <p>If you need more fined grained control over how a validation error type is converted into an error message you may wish to create a
            custom error message resolver.  This is really simple and you can do anything you like to resolve an error type into a error message.  You might
            for instance need to provide a custom translation into the user's language or go to the server etc.</p>

<pre><code class="language-javascript">
angular.module('my-app')
    .factory('myCustomErrorMessageResolver', [
    '$q',
    function ($q) {
        /**
        * @ngdoc function
        * @name defaultErrorMessageResolver#resolve
        * @methodOf defaultErrorMessageResolver
        *
        * @description
        * Resolves a validate error type into a user validation error message
        *
        * @param {String} errorType - The type of validation error that has occurred.
        * @param {Element} el - The input element that is the source of the validation error.
        * @returns {Promise} A promise that is resolved when the validation message has been produced.
        */
        var resolve = function (errorType, el) {
            var defer = $q.defer();
            // do something to get the error message
            // then resolve the promise defer.resolve('some error message');
            return defer.promise;
        };

        return {
            resolve: resolve
        };
    }
]);

// now set the custom error resolver as the module's default one.
angular.module('my-app')
    .run([
    'validator',
    'myCustomErrorMessageResolver',
    function (validator, myCustomErrorMessageResolver) {
        validator.setDefaultErrorMessageResolver(myCustomErrorMessageResolver);
    }
]);
</code></pre>

            <h3 id="custom_dom_modifiers">Custom Element Modifier</h3>

            <p>If you are not using Bootstrap3 or Foundation5 CSS libraries you will need to create a custom element modifier
                which takes care of updating the visual state of an element, don't worry this is really easy! You can see a few example
            of what to put in them <a href="" target="_blank">here</a> and <a href="" target="_blank">here</a>.</p>
<pre><code class="language-javascript">angular.module('my-app')
    .factory('myCustomElementModifier', [
        function () {
            var /**
            * @ngdoc function
            * @name myCustomElementModifier#makeValid
            * @methodOf myCustomElementModifier
            *
            * @description
            * Makes an element appear valid by apply custom styles and child elements.
            *
            * @param {Element} el - The input control element that is the target of the validation.
            */
            makeValid = function (el) {
            // do some code here...
            },

            /**
            * @ngdoc function
            * @name myCustomElementModifier#makeInvalid
            * @methodOf myCustomElementModifier
            *
            * @description
            * Makes an element appear invalid by apply custom styles and child elements.
            *
            * @param {Element} el - The input control element that is the target of the validation.
            * @param {String} errorMsg - The validation error message to display to the user.
            */
            makeInvalid = function (el, errorMsg) {
            // do some code here...
            };

            return {
                makeValid: makeValid,
                makeInvalid: makeInvalid,
                key: 'myCustomModifierKey'
            };
        }
    ]);

// now register the custom element modifier with the auto-validate module and set it as the default one for all elements
angular.module('my-app')
    .run([
    'validator',
    'myCustomElementModifier',
    function (validator, myCustomElementModifier) {
        validator.registerDomModifier(myCustomElementModifier.key, myCustomElementModifier);
        validator.setDefaultElementModifier(myCustomElementModifier.key);
    }
]);

</code></pre>

<h3 id="author">
<a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>Originally authored by <a href="http://www.jonsamwell.com" target="_blank">Jon Samwell</a>.</p>

<h3 id="issues">
<a name="support-or-contact" class="anchor" href="#support-or-contact"><span class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>Add all issues and feature ideas to the <a href="https://github.com/jonsamwell/angular-auto-validate">github repo</a></p>
        </section>

        <aside id="sidebar">
            <h3>Menu</h3>
            <ul>
                <li><a href="#getting_started">Getting Started</a></li>
                <li><a href="#demo">Demo</a></li>
                <li><a href="#your_form">Your Form</a></li>
                <li><a href="#error_message_resolver">Error Message Resolver</a></li>
                <li><a href="#custom_dom_modifiers">Custom Dom Modifiers</a></li>
                <li><a href="#author">Author and Contributors</a></li>
                <li><a href="#issues">Issues and Feature Requests</a></li>
            </ul>
          <a href="https://github.com/jonsamwell/angular-auto-validate/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/jonsamwell/angular-auto-validate/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/jonsamwell/angular-auto-validate"></a> is maintained by <a href="https://github.com/jonsamwell">jonsamwell</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  <script type="text/javascript" src="http://prismjs.com/prism.js"></script>

    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script>
    <script type="text/javascript">
    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate', []);
    }(angular));

    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate')
                .provider('validator', [

                    function () {
                        var elementStateModifiers = {};

                        /**
                         * @ngdoc function
                         * @name validator#setDefaultElementModifier
                         * @methodOf validator
                         *
                         * @description
                         * Sets the default element modifier that will be used by the validator
                         * to change an elements UI state.  Please ensure the modifier has been registered
                         * before setting it as default.
                         *
                         * Note: this can be changed by setting the
                         * element modifier attribute on the input element 'data-element-modifier="myCustomModifier"'
                         *
                         * Example:
                         * <pre>
                         *  app.config(function (validator) {
                 *    validator.setDefaultElementModifier('myCustomModifier');
                 *  });
                         * </pre>
                         *
                         * @param {string} key The key name of the modifier.
                         */
                        this.setDefaultElementModifier = function (key) {
                            if (elementStateModifiers[key] === undefined) {
                                throw new Error('Element modifier not registered: ' + key);
                            }

                            this.defaultElementModifier = key;
                        };

                        /**
                         * @ngdoc function
                         * @name validator#registerDomModifier
                         * @methodOf validator
                         *
                         * @description
                         * Registers an object that adheres to the elementModifier interface and is
                         * able to modifier an elements dom so that appears valid / invalid for a specific
                         * scenario i.e. the Twitter Bootstrap css framework, Foundation CSS framework etc.
                         *
                         * Example:
                         * <pre>
                         *  app.config(function (validator) {
                 *    validator.registerDomModifier('customDomModifier', {
                 *      makeValid: function (el) {
                 *          el.removeClass(el, 'invalid');
                 *          el.addClass(el, 'valid');
                 *      },
                 *      makeInvalid: function (el, err, domManipulator) {
                 *          el.removeClass(el, 'valid');
                 *          el.addClass(el, 'invalid');
                 *      }
                 *    });
                 *  });
                         * </pre>
                         *
                         * @param {string} key The key name of the modifier
                         * @param {object} modifier An object which implements the elementModifier interface
                         */
                        this.registerDomModifier = function (key, modifier) {
                            elementStateModifiers[key] = modifier;
                        };

                        /**
                         * @ngdoc function
                         * @name validator#setErrorMessageResolver
                         * @methodOf validator
                         *
                         * @description
                         * Registers an object that adheres to the elementModifier interface and is
                         * able to modifier an elements dom so that appears valid / invalid for a specific
                         * scenario i.e. the Twitter Bootstrap css framework, Foundation CSS framework etc.
                         *
                         * Example:
                         * <pre>
                         *  app.config(function (validator) {
                 *    validator.setErrorMessageResolver(function (errorKey, el) {
                 *      var defer = $q.defer();
                 *      // resolve the correct error from the given key and resolve the returned promise.
                 *      return defer.promise();
                 *    });
                 *  });
                         * </pre>
                         *
                         * @param {function} resolver A method that returns a promise with the resolved error message in.
                         */
                        this.setErrorMessageResolver = function (resolver) {
                            this.errorMessageResolver = resolver;
                        };

                        /**
                         * @ngdoc function
                         * @name validator#getErrorMessage
                         * @methodOf validator
                         *
                         * @description
                         * Resolves the error message for the given error type.
                         *
                         * @param {String} errorKey The error type.
                         * @param {Element} el The UI element that is the focus of the error.
                         * It is provided as the error message may need information from the element i.e. ng-min (the min allowed value).
                         */
                        this.getErrorMessage = function (errorKey, el) {
                            if (this.errorMessageResolver === undefined) {
                                throw new Error('Please set an error message resolver via the setErrorMessageResolver function before attempting to resolve an error message.');
                            }

                            return this.errorMessageResolver(errorKey, el);
                        };

                        this.getDomModifier = function (el) {
                            var modifierKey = (el !== undefined ? el.attr('element-modifier') : this.defaultElementModifier) ||
                                    (el !== undefined ? el.attr('data-element-modifier') : this.defaultElementModifier) ||
                                    this.defaultElementModifier;

                            if (modifierKey === undefined) {
                                throw new Error('Please set a default dom modifier via the setDefaultElementModifier method on the validator class.');
                            }

                            return elementStateModifiers[modifierKey];
                        };

                        this.makeValid = function (el) {
                            this.getDomModifier(el).makeValid(el);
                        };

                        this.makeInvalid = function (el, errorMsg) {
                            this.getDomModifier(el).makeInvalid(el, errorMsg);
                        };

                        this.$get = [

                            function () {
                                return this;
                            }
                        ];
                    }
                ]);
    }(angular));

    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate')
                .factory('bootstrap3ElementModifier', [

                    function () {
                        var reset = function (el) {
                                    el.find('.error-msg').remove();
                                    el.find('.form-control-feedback').remove();
                                    el.removeClass('has-success has-error has-feedback');
                                },
                                findFormGroupElement = function (el) {
                                    return el.closest('.form-group');
                                },

                                /**
                                 * @ngdoc property
                                 * @name bootstrap3ElementModifier#addValidationStateIcons
                                 * @propertyOf bootstrap3ElementModifier
                                 * @returns {bool} True if an state icon will be added to the element in the valid and invalid control
                                 * states.  The default is false.
                                 */
                                addValidationStateIcons = false,

                                /**
                                 * @ngdoc function
                                 * @name bootstrap3ElementModifier#enableValidationStateIcons
                                 * @methodOf bootstrap3ElementModifier
                                 *
                                 * @description
                                 * Makes an element appear invalid by apply an icon to the input element.
                                 *
                                 * @param {bool} enable - True to enable the icon otherwise false.
                                 */
                                enableValidationStateIcons = function (enable) {
                                    addValidationStateIcons = enable;
                                },

                                /**
                                 * @ngdoc function
                                 * @name bootstrap3ElementModifier#makeValid
                                 * @methodOf bootstrap3ElementModifier
                                 *
                                 * @description
                                 * Makes an element appear valid by apply bootstrap 3 specific styles and child elements. If the service
                                 * property 'addValidationStateIcons' is true it will also append validation glyphicon to the element.
                                 * See: http://getbootstrap.com/css/#forms-control-validation
                                 *
                                 * @param {Element} el - The input control element that is the target of the validation.
                                 */
                                makeValid = function (el) {
                                    var frmGroupEl = findFormGroupElement(el);
                                    reset(frmGroupEl);
                                    frmGroupEl.addClass('has-success has-feedback');
                                    if (addValidationStateIcons) {
                                        el.append(angular.element('<span class="glyphicon glyphicon-ok form-control-feedback"></span>'));
                                    }
                                },

                                /**
                                 * @ngdoc function
                                 * @name bootstrap3ElementModifier#makeInvalid
                                 * @methodOf bootstrap3ElementModifier
                                 *
                                 * @description
                                 * Makes an element appear invalid by apply bootstrap 3 specific styles and child elements. If the service
                                 * property 'addValidationStateIcons' is true it will also append validation glyphicon to the element.
                                 * See: http://getbootstrap.com/css/#forms-control-validation
                                 *
                                 * @param {Element} el - The input control element that is the target of the validation.
                                 */
                                makeInvalid = function (el, errorMsg) {
                                    var frmGroupEl = findFormGroupElement(el),
                                            helpTextEl = angular.element('<span class="help-text has-error error-msg">' + errorMsg + '</span>');
                                    reset(frmGroupEl);
                                    frmGroupEl.addClass('has-error has-feedback');
                                    frmGroupEl.append(helpTextEl);
                                    if (addValidationStateIcons) {
                                        frmGroupEl.append(angular.element('<span class="glyphicon glyphicon-remove form-control-feedback"></span>'));
                                    }
                                };

                        return {
                            makeValid: makeValid,
                            makeInvalid: makeInvalid,
                            enableValidationStateIcons: enableValidationStateIcons,
                            key: 'bs3'
                        };
                    }
                ]);
    }(angular));

    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate').factory('debounce', [

            function () {
                return {
                    debounce: _.debounce
                };
            }
        ]);
    }(angular));

    (function (String, angular) {
        'use strict';

        /**
         * Replaces string placeholders with corresponding template string
         */
        if (!('format' in String.prototype)) {
            String.prototype.format = function () {
                var args = arguments;
                return this.replace(/{(\d+)}/g, function (match, number) {
                    return typeof args[number] !== undefined ? args[number] : match;
                });
            };
        }

        angular.module('jcs-autoValidate')
                .factory('defaultErrorMessageResolver', [
                    '$q',
                    function ($q) {
                        var errorMessages = {
                                    defaultMsg: 'Please add error message for {0}',
                                    email: 'Please enter a valid email address',
                                    minlength: 'Please enter at least {0} characters',
                                    maxlength: 'You have entered more than the maximum {0} characters',
                                    min: 'Please enter the minimum number of {0}',
                                    max: 'Please enter the maximum number of {0}',
                                    required: 'This field is required',
                                    date: 'Please enter a valid date',
                                    pattern: 'Please ensure the entered information adheres to this pattern {0}',
                                    number: 'Please enter a valid number',
                                    url: 'Please enter a valid URL in the format of http(s)://wwww.google.com'
                                },
                                /**
                                 * @ngdoc function
                                 * @name defaultErrorMessageResolver#resolve
                                 * @methodOf defaultErrorMessageResolver
                                 *
                                 * @description
                                 * Resolves a validate error type into a user validation error message
                                 *
                                 * @param {String} errorType - The type of validation error that has occurred.
                                 * @param {Element} el - The input element that is the source of the validation error.
                                 * @returns {Promise} A promise that is resolved when the validation message has been produced.
                                 */
                                resolve = function (errorType, el) {
                                    var defer = $q.defer(),
                                            errMsg = errorMessages[errorType],
                                            parameters = [],
                                            parameter;

                                    if (errMsg === undefined) {
                                        errMsg = errorMessages.defaultMsg.format(errorType);
                                    }

                                    if (el && el.attr) {
                                        try {
                                            parameter = el.attr(errorType);
                                            if (parameter === undefined) {
                                                parameter = el.attr('data-ng-' + errorType) || el.attr('ng-' + errorType);
                                            }

                                            parameters.push(parameter || '');

                                            errMsg = errMsg.format(parameters);
                                        } catch (e) {}
                                    }

                                    defer.resolve(errMsg);
                                    return defer.promise;
                                };

                        return {
                            errorMessages: errorMessages,
                            resolve: resolve
                        };
                    }
                ]);
    }(String, angular));

    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate')
                .factory('foundation5ElementModifier', [

                    function () {
                        var reset = function (el) {
                                    el.find('small.error').remove();
                                    el.removeClass('error');
                                },
                                findParentColumn = function (el) {
                                    return el.closest('.columns');
                                },

                                /**
                                 * @ngdoc function
                                 * @name foundation5ElementModifier#makeValid
                                 * @methodOf foundation5ElementModifier
                                 *
                                 * @description
                                 * Makes an element appear valid by apply Foundation 5 specific styles and child elements.
                                 * See: http://foundation.zurb.com/docs/components/forms.html
                                 *
                                 * @param {Element} el - The input control element that is the target of the validation.
                                 */
                                makeValid = function (el) {
                                    var parentColumn = findParentColumn(el);
                                    reset(parentColumn && parentColumn.length > 0 ? parentColumn : el);
                                },

                                /**
                                 * @ngdoc function
                                 * @name foundation5ElementModifier#makeInvalid
                                 * @methodOf foundation5ElementModifier
                                 *
                                 * @description
                                 * Makes an element appear invalid by apply Foundation 5 specific styles and child elements.
                                 * See: http://foundation.zurb.com/docs/components/forms.html
                                 *
                                 * @param {Element} el - The input control element that is the target of the validation.
                                 */
                                makeInvalid = function (el, errorMsg) {
                                    var parentColumn = findParentColumn(el),
                                            helpTextEl;
                                    reset(parentColumn || el);
                                    el.addClass('error');
                                    if (parentColumn) {
                                        helpTextEl = angular.element('<small class="error">' + errorMsg + '</small>');
                                        parentColumn.append(helpTextEl);
                                    }
                                };

                        return {
                            makeValid: makeValid,
                            makeInvalid: makeInvalid,
                            key: 'foundation5'
                        };
                    }
                ]);
    }(angular));

    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate')
                .factory('validationManager', [
                    'validator',
                    function (validator) {
                        var
                                /**
                                 * @ngdoc validateElement
                                 * @name validation#validateElement
                                 * @param {object} modelCtrl holds the information about the element e.g. $invalid, $valid
                                 * @description
                                 * Validate the form element and make invalid/valid element model status.
                                 */
                                validateElement = function (modelCtrl, el) {
                                    var isValid,
                                            errorType,
                                            needsValidation = (modelCtrl.$parsers.length > 0 || modelCtrl.$formatters.length > 0) && modelCtrl.$pristine === false,
                                            findErrorType = function ($errors) {
                                                var keepGoing = true,
                                                        errorTypeToReturn;
                                                angular.forEach($errors, function (status, errortype) {
                                                    if (keepGoing && status) {
                                                        keepGoing = false;
                                                        errorTypeToReturn = errortype;
                                                    }
                                                });

                                                return errorTypeToReturn;
                                            };

                                    if (modelCtrl && needsValidation) {
                                        isValid = !modelCtrl.$invalid;
                                        if (isValid) {
                                            validator.makeValid(el);
                                        } else {
                                            errorType = findErrorType(modelCtrl.$error);

                                            validator.getErrorMessage(errorType, el).then(function (errorMsg) {
                                                validator.makeInvalid(el, errorMsg);
                                            });
                                        }

                                        return isValid;
                                    }
                                };

                        return {
                            validateElement: validateElement
                        };
                    }
                ]);
    }(angular));

    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate').config(['$provide',
            function ($provide) {
                $provide.decorator('ngModelDirective', [
                    '$delegate',
                    'validationManager',
                    'debounce',
                    function ($delegate, validationManager, debounce) {
                        var directive = $delegate[0],
                                link = directive.link;

                        directive.compile = function () {
                            return function (scope, element, attrs, ctrls) {
                                var ngModelCtrl = ctrls[0],
                                        supportsNgModelOptions = angular.version.major >= 1 && angular.version.minor >= 3,
                                        ngModelOptions = attrs.ngModelOptions === undefined ? undefined : scope.$eval(attrs.ngModelOptions),
                                        setValidity = ngModelCtrl.$setValidity,
                                        setValidationState = debounce.debounce(function () {
                                            validationManager.validateElement(ngModelCtrl, element);
                                        }, 100);

                                if (attrs.formnovalidate === undefined) {
                                    if (supportsNgModelOptions || ngModelOptions === undefined || ngModelOptions.updateOn === undefined || ngModelOptions.updateOn === '') {
                                        ngModelCtrl.$setValidity = function (validationErrorKey, isValid) {
                                            setValidity.call(ngModelCtrl, validationErrorKey, isValid);
                                            setValidationState();
                                        };
                                    } else {
                                        element.on(ngModelOptions.updateOn, function () {
                                            setValidationState();
                                        });

                                        scope.$on('$destroy', function () {
                                            element.off(ngModelOptions.updateOn);
                                        });
                                    }

                                    ngModelCtrl.autoValidated = true;
                                }

                                link.apply(this, arguments);
                            };
                        };

                        return $delegate;
                    }
                ]);
            }
        ]);
    }(angular));

    (function (angular) {
        'use strict';

        angular.module('jcs-autoValidate')
                .run([
                    'validator',
                    'defaultErrorMessageResolver',
                    'bootstrap3ElementModifier',
                    'foundation5ElementModifier',
                    function (validator, defaultErrorMessageResolver, bootstrap3ElementModifier, foundation5ElementModifier) {
                        validator.setErrorMessageResolver(defaultErrorMessageResolver.resolve);
                        validator.registerDomModifier(bootstrap3ElementModifier.key, bootstrap3ElementModifier);
                        validator.registerDomModifier(foundation5ElementModifier.key, foundation5ElementModifier);
                        validator.setDefaultElementModifier(bootstrap3ElementModifier.key);
                    }
                ]);
    }(angular));
        (function (angular) {
            var app = angular.module('jcs-demo', ['jcs-autoValidate']);

            app.controller('demoCtrl', [
                '$scope',
                'bootstrap3ElementModifier',
                function ($scope, bootstrap3ElementModifier) {
                    $scope.user = {};
                    $scope.bs3Icons = false;

                    $scope.toggleBS3Icons = function () {
                        $scope.bs3Icons = !$scope.bs3Icons;
                        bootstrap3ElementModifier.enableValidationStateIcons($scope.bs3Icons);
                    }

                    $scope.toggleBS3Icons();
                }
            ]);

            app.directive('mustcontainword', [
                function() {
                return {
                    restrict: 'A',
                    require: 'ngModel',
                    link: function(scope, elm, attrs, ctrl) {
                        ctrl.$parsers.unshift(function (viewValue) {
                            if (viewValue.toLowerCase().indexOf(attrs.mustcontainword.toLowerCase()) === -1) {
                                ctrl.$setValidity('mustcontainword', false);
                                return undefined;
                            } else {
                                ctrl.$setValidity('mustcontainword', true);
                                return viewValue;
                            }
                        });
                    }
                }
            }]);

            app.factory('myCustomElementModifier', [
                function () {
                    var /**
                             * @ngdoc function
                             * @name myCustomElementModifier#makeValid
                             * @methodOf myCustomElementModifier
                             *
                             * @description
                             * Makes an element appear valid by apply custom styles and child elements.
                             *
                             * @param {Element} el - The input control element that is the target of the validation.
                             */
                            makeValid = function (el) {
                                el.removeClass('bg-red');
                                el.addClass('bg-green');
                            },

                            /**
                             * @ngdoc function
                             * @name myCustomElementModifier#makeInvalid
                             * @methodOf myCustomElementModifier
                             *
                             * @description
                             * Makes an element appear invalid by apply custom styles and child elements.
                             *
                             * @param {Element} el - The input control element that is the target of the validation.
                             * @param {String} errorMsg - The validation error message to display to the user.
                             */
                            makeInvalid = function (el, errorMsg) {
                                el.removeClass('bg-green');
                                el.addClass('bg-red');
                            };

                    return {
                        makeValid: makeValid,
                        makeInvalid: makeInvalid,
                        key: 'myCustomModifierKey'
                    };
                }
            ]);

            // now register the custom element modifier with the auto-validate module and set it as the default one for all elements
            app.run([
                'validator',
                'myCustomElementModifier',
                 'defaultErrorMessageResolver',
                function (validator, myCustomElementModifier, defaultErrorMessageResolver) {
                    validator.registerDomModifier(myCustomElementModifier.key, myCustomElementModifier);
                    defaultErrorMessageResolver.errorMessages['mustcontainword'] = 'Please enter the word "{0}"';
                }
            ]);
        }(angular));
    </script>
  </body>
</html>